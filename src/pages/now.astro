---
const name = "Yuval Ginor";
const title = "What I'm doing now";
---

<!doctype html>
<html class="scroll-smooth" lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="What I'm doing now" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <meta name="generator" content={Astro.generator} />
    <title>{name} - Now</title>
    <link rel="stylesheet" href="/src/styles/global.css" />
    
    <script is:inline>
      const systemPref = window.matchMedia("(prefers-color-scheme: light)");

      function getStoredMode() {
        const stored = typeof localStorage !== "undefined" && localStorage.getItem("color-mode");
        return stored || (systemPref.matches ? "light" : "dark");
      }

      function applyMode(mode) {
        if (mode !== "light" && mode !== "dark") {
          return console.warn(`Invalid mode: ${mode}`);
        }

        const root = document.documentElement;

        if (mode === root.getAttribute("data-mode")) {
          return;
        }

        root.setAttribute("data-mode", mode);

        if (typeof localStorage !== "undefined") {
          localStorage.setItem("color-mode", mode);
        }
      }

      applyMode(getStoredMode());

      document.addEventListener("astro:after-swap", () => applyMode(getStoredMode()));

      document.addEventListener("mode-toggle", (e) => {
        applyMode(e.detail.mode);
      });

      systemPref.addEventListener("change", (e) => applyMode(e.matches ? "light" : "dark"));
    </script>
  </head>
  <body class="bg-bg-base text-text-primary mx-auto flex min-h-screen max-w-3xl flex-col px-4 pt-16 font-mono text-sm font-normal antialiased sm:px-8">
    <header class="group relative mb-10 flex items-center justify-end" id="site-header">
      <nav aria-label="Primary navigation" class="flex gap-6 relative" id="main-nav">
        <a href="/" class="nav-link transition-colors hover:text-[var(--color-brand)]">
          home
        </a>
        <a href="/now" class="nav-link current-page transition-colors hover:text-[var(--color-brand)]">
          now
        </a>
        <span class="nav-underline" aria-hidden="true"></span>
      </nav>
    </header>
    <theme-switch class="fixed bottom-8 right-8 z-50">
      <button class="relative h-9 w-9 cursor-pointer rounded-md p-2 transition-colors hover:text-[var(--color-accent-secondary)]" type="button">
        <span class="sr-only">Toggle color mode</span>
        <svg
          aria-hidden="true"
          class="absolute inset-0 m-auto h-8 w-8 opacity-100 transition-opacity duration-200 dark:opacity-0"
          fill="none"
          focusable="false"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle cx="12" cy="12" r="4"/>
          <path d="M12 3v1"/>
          <path d="M12 20v1"/>
          <path d="M3 12h1"/>
          <path d="M20 12h1"/>
          <path d="m18.364 5.636-.707.707"/>
          <path d="m6.343 17.657-.707.707"/>
          <path d="m5.636 5.636.707.707"/>
          <path d="m17.657 17.657.707.707"/>
        </svg>
        <svg
          aria-hidden="true"
          class="absolute inset-0 m-auto h-8 w-8 opacity-0 transition-opacity duration-200 dark:opacity-100"
          fill="none"
          focusable="false"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
          <path d="M19 3v4"/>
          <path d="M21 5h-4"/>
        </svg>
      </button>
    </theme-switch>

    <main id="main">
      <div class="prose prose-neutral dark:prose-invert max-w-none space-y-6">
        <h1 class="text-brand-emphasis text-xl font-semibold mb-6">{title}</h1>
        
        <section>
          <p class="text-text-muted mb-4">
            <em>This is a <a href="https://nownownow.com/about" target="_blank" rel="noopener noreferrer" class="hover:text-link underline">/now page</a>, inspired by Derek Sivers. It's a living document of what I'm focused on right now.</em>
          </p>
          <p class="text-text-muted text-xs">
            Last updated: November 2025
          </p>
        </section>

        <section>
          <h2 class="text-brand-emphasis text-lg font-semibold mb-3">What I'm working on</h2>
          <p>
            [Content to be added - describe your current projects, work, and professional focus]
          </p>
        </section>

        <section>
          <h2 class="text-brand-emphasis text-lg font-semibold mb-3">What I'm learning</h2>
          <p>
            [Content to be added - describe what you're currently learning or exploring]
          </p>
        </section>

        <section>
          <h2 class="text-brand-emphasis text-lg font-semibold mb-3">What I'm thinking about</h2>
          <p>
            [Content to be added - share ideas, questions, or themes you're contemplating]
          </p>
        </section>

        <section>
          <h2 class="text-brand-emphasis text-lg font-semibold mb-3">Life updates</h2>
          <p>
            [Content to be added - personal updates, location, lifestyle, etc.]
          </p>
        </section>
      </div>
    </main>

    <script>
      function isDarkMode() {
        return document.documentElement.getAttribute("data-mode") === "dark";
      }

      class ThemeSwitch extends HTMLElement {
        constructor() {
          super();
          const button = this.querySelector<HTMLButtonElement>("button");

          if (button) {
            button.setAttribute("role", "switch");
            button.setAttribute("aria-checked", String(isDarkMode()));

            button.addEventListener("click", () => {
              const toggleEvent = new CustomEvent("mode-toggle", {
                detail: {
                  mode: isDarkMode() ? "light" : "dark",
                },
              });
              document.dispatchEvent(toggleEvent);

              button.setAttribute("aria-checked", String(isDarkMode()));
            });
          } else {
            console.warn("ThemeSwitch: Button element not found");
          }
        }
      }

      customElements.define("theme-switch", ThemeSwitch);

      // Sliding underline navigation
      const nav = document.getElementById("main-nav");
      const links = nav.querySelectorAll(".nav-link");
      const underline = nav.querySelector(".nav-underline");
      const currentPage = nav.querySelector(".current-page");

      function setUnderlinePosition(link, instant = false) {
        const linkRect = link.getBoundingClientRect();
        const navRect = nav.getBoundingClientRect();
        
        if (instant) {
          underline.style.transition = 'none';
        }
        
        underline.style.left = `${linkRect.left - navRect.left}px`;
        underline.style.width = `${linkRect.width}px`;
        
        if (instant) {
          // Force reflow to apply the position immediately
          underline.offsetHeight;
          underline.style.transition = '';
        }
      }

      // Initialize underline position on current page (instantly, no animation)
      if (currentPage) {
        setUnderlinePosition(currentPage, true);
      }

      // Add hover listeners
      links.forEach(link => {
        link.addEventListener("mouseenter", () => {
          setUnderlinePosition(link);
        });
      });

      // Return to current page when not hovering
      nav.addEventListener("mouseleave", () => {
        if (currentPage) {
          setUnderlinePosition(currentPage);
        }
      });

      // Update on resize
      window.addEventListener("resize", () => {
        if (currentPage) {
          setUnderlinePosition(currentPage);
        }
      });
    </script>
  </body>
</html>

